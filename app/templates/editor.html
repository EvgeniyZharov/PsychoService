{% extends 'base_page.html' %}
{% block title %}–†–µ–¥–∞–∫—Ç–æ—Ä –∫—É—Ä—Å–æ–≤ | MindGrow{% endblock %}

{% block content %}

  <!-- –ü–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
  <div x-data="{ section: '', subsection: '' }" class="pt-20 px-6 bg-gradient-to-br from-white to-indigo-50 min-h-screen">
  <h1 class="text-3xl font-bold text-indigo-700 mb-6">üõ† –†–µ–¥–∞–∫—Ç–æ—Ä –∫—É—Ä—Å–æ–≤</h1>

  <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
  <div class="flex space-x-4 mb-6">
    <button @click="section = 'add'; subsection = ''" :class="section === 'add' ? 'bg-indigo-500 text-white' : 'bg-white text-indigo-600'" class="btn px-4 py-2 rounded shadow">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
    <button @click="section = 'delete'; subsection = ''" :class="section === 'delete' ? 'bg-red-500 text-white' : 'bg-white text-red-600'" class="btn px-4 py-2 rounded shadow">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
    <button @click="section = 'update'; subsection = ''" :class="section === 'update' ? 'bg-blue-500 text-white' : 'bg-white text-blue-600'" class="btn px-4 py-2 rounded shadow">üõ† –ò–∑–º–µ–Ω–∏—Ç—å</button>
  </div>

  <!-- –ü–æ–¥–º–µ–Ω—é (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–æ —Ä–∞–∑–¥–µ–ª—É) -->
  <div x-show="section" class="flex gap-3 mb-8">
    <template x-if="section === 'add'">
      <div class="flex gap-3">
        <button @click="subsection = 'test'" class="btn-secondary">üß™ –¢–µ—Å—Ç</button>
        <button @click="subsection = 'course'" class="btn-secondary">üìò –ö—É—Ä—Å</button>
        <button @click="subsection = 'lesson'" class="btn-secondary">üìñ –£—Ä–æ–∫</button>
      </div>

    </template>

    <template x-if="section === 'delete'">
      <div class="flex gap-3">
        <button @click="subsection = 'delete_test'" class="btn-secondary">üóë –¢–µ—Å—Ç</button>
        <button @click="subsection = 'delete_course'" class="btn-secondary">üóë –ö—É—Ä—Å</button>
      </div>
    </template>

    <template x-if="section === 'update'">
      <div class="flex gap-3">
        <button @click="subsection = 'edit_test'" class="btn-secondary">‚úèÔ∏è –¢–µ—Å—Ç</button>
        <button @click="subsection = 'edit_course'" class="btn-secondary">‚úèÔ∏è –ö—É—Ä—Å</button>
      </div>
    </template>
  </div>
    <div x-show="subsection === 'delete_test'" class="bg-white p-6 rounded shadow space-y-4">
      <h2 class="text-xl font-bold text-red-600 mb-4">üóë –£–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç</h2>
      <form id="delete-test-form">
        <label class="block font-medium text-gray-700 mb-2">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è</label>
        <select name="test_id" required class="w-full input border px-4 py-2 rounded">
          {% for test in tests %}
            <option value="{{ test.id }}">{{ test.title }}</option>
          {% endfor %}
        </select>
        <button type="submit" class="mt-4 bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700">
          –£–¥–∞–ª–∏—Ç—å
        </button>
        <p id="delete-test-status" class="text-green-600 hidden mt-2">‚úÖ –¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω!</p>
      </form>
    </div>
    <div x-show="subsection === 'delete_course'" class="bg-white p-6 rounded shadow space-y-4">
      <h2 class="text-xl font-bold text-red-600 mb-4">üóë –£–¥–∞–ª–∏—Ç—å –∫—É—Ä—Å</h2>
      <form id="delete-course-form">
        <label class="block font-medium text-gray-700 mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è</label>
        <select name="course_id" required class="w-full input border px-4 py-2 rounded">
          {% for course in courses %}
            <option value="{{ course.id }}">{{ course.title }}</option>
          {% endfor %}
        </select>
        <button type="submit" class="mt-4 bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700">
          –£–¥–∞–ª–∏—Ç—å
        </button>
        <p id="delete-course-status" class="text-green-600 hidden mt-2">‚úÖ –ö—É—Ä—Å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω!</p>
      </form>
    </div>

    <div x-show="subsection === 'edit_test'" class="bg-white p-6 rounded shadow space-y-4">
      <form method="POST" action="{{ url_for('editor.update_test') }}">
        <label class="block font-medium text-gray-700">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç</label>
        <select name="test_id" class="w-full border px-2 py-1 rounded mb-2" x-model="selectedTestId" @change="fetchTestData($event)">
          {% for test in tests %}
            <option value="{{ test.id }}">{{ test.title }}</option>
          {% endfor %}
        </select>

        <input type="text" name="title" x-model="testData.title" class="border rounded px-2 py-1 mb-1 w-full" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞">
        <textarea name="description" x-model="testData.description" class="border rounded px-2 py-1 mb-1 w-full" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>

        <button type="submit" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </form>

    </div>
    <div x-show="subsection === 'edit_course'" class="bg-white p-6 rounded shadow space-y-4">
      <form method="POST" action="{{ url_for('editor.update_course') }}">
        <label class="block font-medium text-gray-700">–í—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ä—Å</label>
        <select name="course_id" class="w-full border px-2 py-1 rounded mb-2" x-model="selectedCourseId">
          {% for course in courses %}
            <option value="{{ course.id }}">{{ course.title }}</option>
          {% endfor %}
        </select>

        <input type="text" name="title" x-model="courseData.title" class="border rounded px-2 py-1 mb-1 w-full" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞">
        <textarea name="description" x-model="courseData.description" class="border rounded px-2 py-1 mb-1 w-full" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞"></textarea>

        <button type="submit" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </form>
    </div>

  <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞ -->
<div x-show="subsection === 'test'" class="bg-white p-6 rounded shadow space-y-4">
  <h2 class="text-xl font-bold text-indigo-700 mb-4">üß™ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç</h2>
  <!-- –ó–∞–≥—Ä—É–∑–∫–∞ CSV —Ñ–∞–π–ª–æ–≤ -->
  <form id="add-test-form" action="/upload_test_csv" enctype="multipart/form-data">
    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–º—ã -->
    <div>
          <label>üìÑ CSV —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –∏ –æ—Ç–≤–µ—Ç–∞–º–∏: </label>
          <input type="file" name="csv_asks" accept=".csv" required>
        </div>
        <div>
          <label>üìÑ CSV —Å —á–µ—Ä—Ç–∞–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏: </label>
          <input type="file" name="csv_traits" accept=".csv" required>
        </div>
    <div>
      <label class="block font-medium text-gray-700">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã</label>
      <input type="text" name="title" required class="w-full input border px-4 py-2 rounded mt-1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–∫—Ü–µ–Ω—Ç—É–∞—Ü–∏–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞">
    </div>

    <div>
      <label class="block font-medium text-gray-700 mt-4">–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–º—ã</label>
      <textarea name="description" rows="3" class="w-full input border px-4 py-2 rounded mt-1" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞..."></textarea>
    </div>

    <!-- –ì–∞–ª–æ—á–∫–∞ -->
    <div class="pt-3">
        <label class="flex items-center">
            <input type="checkbox" name="is_public" value="true" class="mr-2">
            <span>–°–¥–µ–ª–∞—Ç—å —Ç–µ—Å—Ç –≥–ª–∞–≤–Ω—ã–º</span>
        </label>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
    <div class="pt-4">
      <button type="submit" class="bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700">
        üíæ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç
      </button>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å -->
    <p id="add-test-status" class="text-green-600 hidden mt-2">‚úÖ –¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!</p>
  </form>
</div>

  <div x-show="subsection === 'course'" class="bg-white p-6 rounded shadow">
    <h2 class="text-xl font-semibold text-indigo-600 mb-4">üìò –î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å</h2>
    <div x-show="subsection === 'course'" class="bg-white p-6 rounded shadow">
  <h2 class="text-xl font-semibold text-indigo-600 mb-4">üìò –î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å</h2>

  <form id="add-course-form">
    <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞ -->
    <div>
      <label class="block font-medium text-gray-700">–ù–∞–∑–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞</label>
      <input type="text" name="title" required class="w-full input border px-4 py-2 rounded mt-1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –†–∞–∑–≤–∏—Ç–∏–µ —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏">
    </div>

    <!-- –£—Ä–æ–≤–µ–Ω—å –∫—É—Ä—Å–∞ -->
    <div class="mt-4">
      <label class="block font-medium text-gray-700">–£—Ä–æ–≤–µ–Ω—å (1‚Äì20)</label>
      <select name="level" required class="w-full input border px-4 py-2 rounded mt-1">
        {% for i in range(1, 21) %}
          <option value="{{ i }}">{{ i }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- –¢–∏–ø –∫—É—Ä—Å–∞ -->
    <div class="mt-4">
      <label class="block font-medium text-gray-700">–¢–∏–ø –∫—É—Ä—Å–∞</label>
      <select name="type" required class="w-full input border px-4 py-2 rounded mt-1">
        <option value="main">–û—Å–Ω–æ–≤–Ω–∞—è –≤–µ—Ç–∫–∞</option>
        <option value="secondary">–í—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è</option>
      </select>
    </div>

    <!-- –û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞ -->
    <div class="mt-4">
      <label class="block font-medium text-gray-700">–û–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞</label>
      <textarea name="description" rows="3" class="w-full input border px-4 py-2 rounded mt-1" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫—É—Ä—Å–∞..."></textarea>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
    <div class="pt-4">
      <button type="submit" class="bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700">
        üíæ –î–æ–±–∞–≤–∏—Ç—å –∫—É—Ä—Å
      </button>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å -->
    <p id="add-course-status" class="text-green-600 hidden mt-2">‚úÖ –ö—É—Ä—Å –¥–æ–±–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!</p>
  </form>
</div>
  </div>
<div x-show="subsection === 'lesson'" class="bg-white p-6 rounded shadow space-y-4">
  <h2 class="text-xl font-bold text-indigo-700 mb-4">üìñ –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫</h2>
  <!-- –í—ã–±–æ—Ä –∫—É—Ä—Å–∞ -->


  <!-- 1. –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—Ä–æ–∫–∞ -->
  <form id="add-lesson-form">
    <div class="mt-4">
      <label class="block font-medium text-gray-700">–ö—É—Ä—Å</label>
      <select name="course_title" required class="w-full input border px-4 py-2 rounded mt-1">
        {% for course in courses %}
          <option value="{{ course.title }}">{{ course.title }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="block font-medium text-gray-700">–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞</label>
      <input type="text" name="title" required class="w-full input border px-4 py-2 rounded mt-1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û—Å–Ω–æ–≤—ã —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏">
    </div>

    <div class="mt-4">
      <label class="block font-medium text-gray-700">–û–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–∞</label>
      <textarea name="description" rows="3" class="w-full input border px-4 py-2 rounded mt-1" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–∞..."></textarea>
    </div>

    <div class="pt-4">
      <button type="submit" class="bg-indigo-600 text-white px-6 py-2 rounded hover:bg-indigo-700">
        üíæ –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫
      </button>
    </div>
    <p id="add-lesson-status" class="text-green-600 hidden mt-2">‚úÖ –£—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω</p>
  </form>

  <!-- 2. –ó–∞–≥—Ä—É–∑–∫–∞ CSV-–∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∫ —É—Ä–æ–∫—É -->
  <form action="/upload_lesson_content_csv" method="POST" enctype="multipart/form-data" class="mt-6">
    <div class="mt-4">
      <label class="block font-medium text-gray-700">–ö—É—Ä—Å</label>
      <select name="course_title" required class="w-full input border px-4 py-2 rounded mt-1">
        {% for course in courses %}
          <option value="{{ course.title }}">{{ course.title }}</option>
        {% endfor %}
      </select>
    </div>
    <label class="block font-medium text-gray-700 mb-1">üìÑ CSV —Å –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º —É—Ä–æ–∫–∞</label>
    <input type="file" name="csv_file" accept=".csv" required class="mb-2">
    <button type="submit" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">üíæ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç</button>
  </form>
  <!-- –ó–∞–≥—Ä—É–∑–∫–∞ zip —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏ -->
  <form action="/upload_lesson_images_zip" method="POST" enctype="multipart/form-data" class="mt-6">
    <div class="mt-4">
      <label class="block font-medium text-gray-700">–ö—É—Ä—Å</label>
      <select name="course_id" required class="w-full input border px-4 py-2 rounded mt-1">
        {% for course in courses %}
          <option value="{{ course.title }}">{{ course.title }}</option>
        {% endfor %}
      </select>
    </div>
    <label class="block font-medium text-gray-700 mt-4">üóÇ Zip-–∞—Ä—Ö–∏–≤ —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏</label>
    <input type="file" name="zip_file" accept=".zip" required class="mb-2">
    <button type="submit" class="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600">üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</button>
  </form>



</div>
</div>


  <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ -->

<script>
  document.getElementById("add-test-form").addEventListener("submit", function(e) {
  e.preventDefault();

  const formData = new FormData(this);

  fetch("/upload_test_csv", {
    method: "POST",
    body: formData
  })
  .then(res => res.ok ? res.text() : Promise.reject("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"))
  .then(() => {
    document.getElementById("add-test-status").classList.remove("hidden");
    this.reset();
  })
  .catch(err => alert("‚ùå " + err));
});

document.getElementById("add-course-form").addEventListener("submit", function(e) {
    e.preventDefault();
    const formData = new FormData(this);

    fetch("/upload_course", {
      method: "POST",
      body: formData
    })
    .then(res => res.ok ? res.text() : Promise.reject("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—Å–∞"))
    .then(() => {
      document.getElementById("add-course-status").classList.remove("hidden");
      this.reset();
    })
    .catch(err => alert("‚ùå " + err));
  });

  document.getElementById("add-lesson-form").addEventListener("submit", function(e) {
    e.preventDefault();
    const formData = new FormData(this);

    fetch("/upload_lesson", {
      method: "POST",
      body: formData
    })
    .then(res => res.ok ? res.text() : Promise.reject("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–∞"))
    .then(() => {
      document.getElementById("add-lesson-status").classList.remove("hidden");
      this.reset();
    })
    .catch(err => alert("‚ùå " + err));
  });

  document.getElementById("delete-test-form").addEventListener("submit", function(e) {
  e.preventDefault();
  const formData = new FormData(this);

  fetch("/delete_test", {
    method: "POST",
    body: formData
  })
  .then(res => res.ok ? res.text() : Promise.reject("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è"))
  .then(() => {
    document.getElementById("delete-test-status").classList.remove("hidden");
    this.reset();
  })
  .catch(err => alert("‚ùå " + err));
});

  document.getElementById("delete-course-form").addEventListener("submit", function(e) {
  e.preventDefault();
  const formData = new FormData(this);

  fetch("/delete_course", {
    method: "POST",
    body: formData
  })
  .then(res => res.ok ? res.text() : Promise.reject("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫—É—Ä—Å–∞"))
  .then(() => {
    document.getElementById("delete-course-status").classList.remove("hidden");
    this.reset();
  })
  .catch(err => alert("‚ùå " + err));
});

</script>

{% endblock %}
